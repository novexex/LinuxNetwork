## part1
### 1.1 Сети и маски

*1) Адрес сети 192.167.38.54/13*
![](images/1.1.png)
*2) Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную*

**255.255.255.0 -> /24 -> 11111111.11111111.11111111.00000000**
![](images/1.1.2.png)

**/15 -> 255.254.0.0 -> 11111111.11111110.00000000.00000000**
![](images/1.1.3.png)

**11111111.11111111.11111111.11110000 -> /28 -> 255.255.255.240**
![](images/1.1.4.png)

*3) Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4*
![](images/1.1.1.png)

![](images/1.1.5.png)

### 1.2. localhost
*Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1*
![](images/1.2.png)

### 1.3. Диапазоны и сегменты сетей

*1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1*

	Зарезервированные IP адреса IPv4, которые не маршрутизируются в интернет, а предназначены для построения локальных сетей и VPN сетей:   
	10.0.0.0 — 10.255.255.255 (маска подсети для бесклассовой (CIDR) адресации: 255.0.0.0 или /8).  
	172.16.0.0 — 172.31.255.255 (маска подсети: 255.240.0.0 или /12)   
	192.168.0.0 — 192.168.255.255 (маска подсети: 255.255.0.0 или /16)

**10.0.0.45 - частный.  
134.43.0.2 - публичный.   
192.168.4.2 - частный.   
172.20.250.4 - частный.  
172.0.2.1 - публичный.  
192.172.0.1 - публичный.  
172.68.0.2 - публичный.  
172.16.255.255 - частный.  
10.10.10.10 - частный.  
192.169.168.1 - публичный.**

*2) какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255*
![](images/1.3.png)
**10.0.0.1 - не возможен.  
10.10.0.2 - возможен.  
10.10.10.10 - возможен.  
10.10.100.1 - не возможен.   
10.10.1.255 - не возможен.**
## part2
*С помощью команды ip a посмотреть существующие сетевые интерфейсы*  
ws1:    
![](images/2.ws1.png)
ws2:    
![](images/2.ws2.png)

*Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12*

- Сетевой интерфейс для внутренней сети - enp0s8.

ws1:    
![](images/faces1.png)
ws2:    
![](images/faces2.png)

*Выполнить команду netplan apply для перезапуска сервиса сети*

ws1:     
![](images/wc1a.png)
ws2:     
![](images/wc2a.png)

### 2.1. Добавление статического маршрута вручную

*Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида ip r add*

ws1:
![](images/add1.png)
ws2:
![](images/add2.png)
pings:
![](images/pi1.png)
![](images/pi2.png)

### 2.2. Добавление статического маршрута с сохранением

Добавить статический маршрут от одной машины до другой с помощью файла etc/netplan/00-installer-config.yaml   
ws1:    
![](images/cfg1.png)
ws2:     
![](images/cfg2.png)
pings:    
![](images/pin1.png)
![](images/pin2.png)
## part3
### 3.1. Скорость соединения
8 Мегабит/с == 8 / 1 == 1 МегаБайт/с   
100 МегаБайт/с == 100 * 8 * 1024 == 819200 Килобит/с    
1 Гигабит/с == 1* 1024 == 1024 Мегабит/с

### 3.2. Утилита iperf3
На одной машине мы пишем  
**$ iperf -s**   
тем самым делая её серверной, а на другой    
**$ iperf -c 192.168.100.10**   
тем самым подключаяюсь к первой машине
![](images/spidtest.png)

## part4
### 4.1. Утилита iptables
ws1:
![](images/ws1tables.png)
ws2:
![](images/ws2tables.png)

**Запустить файлы на обеих машинах командами chmod +x /etc/firewall.sh и /etc/firewall.sh**

**chmod:**   
ws1:    
![](images/ws1chmod.png)
ws2:    
![](images/ws2chmod.png)

**sh:**     
ws1:
![](images/ws1sh.png)
ws2:
![](images/ws2sh.png)
### 4.2. Утилита nmap
**Командой ping найти машину, которая не "пингуется", после чего утилитой nmap показать, что хост машины запущен**
![](images/pink.png)
## part5
### 5.1. Настройка адресов машин
![](images/part5_network.png)
r1:    
![](images/r1.png)
r2:    
![](images/r2.png)
ws11:    
![](images/ws111.png)
ws21:   
![](images/ws222.png)
ws22:    
![](images/ws21.png)

**$ ip -4 a:**   
r1:
![](images/ipr1.png)
r2:
![](images/ipr2.png)
ws11:
![](images/ipws1.png)
ws21:
![](images/ipws21.png)
ws22:
![](images/ipws22.png)

**pings:**  
r1 & ws11:
![](images/pingr1ws11.png)
ws22 & ws21:
![](images/pingws22ws21.png)

### 5.2. Включение переадресации IP-адресов.
Выключаем переадресацию IP  
r1:
![](images/netr1.png)
r2:
![](images/netr2.png)

В конфиге тоже меняем, чтобы она была отключена на постоянной основе

r1:
![](images/sysr1.png)
r2:
![](images/sysr2.png)

### 5.3. Установка маршрута по-умолчанию
Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить gateway4 [ip роутера] в файле конфигураций

ws11:    
![](images/zxc.png)
ws21:    
![](images/gatws21.png)
ws22:    
![](images/gatws22.png)

**$ ip r** 

ws11:
![](images/rws1.png)
ws21:
![](images/rws21.png)
ws22:
![](images/rws22.png)

Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит. Для этого использовать команду:

![](images/pinks.png)

### 5.4. Добавление статических маршрутов

Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций. 

r1:    
![](images/r1stat.png)
r2:    
![](images/r2stat.png)

**$ ip r**   
r1:
![](images/r1ipr.png)
r2:
![](images/r2ipr.png)

Запустить команды на ws11:
ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0
![](images/iprlist.png)

Для 0.0.0.0 выбран другой маршрут, потому что он более точный.

### 5.5. Построение списка маршрутизаторов

Утилита traceroute выводит каждый узел, через который проходит пакет. 
![](images/tcpdump.png)
![](images/traceroute.png)
Пакет поступает на роутер r1 и отправляется по адресу 10.100.0.12 по сети 10.100.0.0 и оттуда уже пакет доставляется по конечному адресу через 10.20.0.0 сеть

### Part 6. Динамическая настройка IP с помощью DHCP

**$ sudo apt install isc-dhcp-server**

Настраиваем DHCP в конфиге (/etc/dhcp/dhcpd.conf)

r1:   
![](images/dhcpr1.png)    
также прописываем dns сервер в /etc/resolv.conf
![](images/resolvr1.png)
перезагружаем DHCP службу  
 
**$ systemctl restart isc-dhcp-server**   

![](images/restart.png)
Машину ws21 перезагрузить при помощи reboot и через ip a показать, что она получила адрес. Также пропинговать ws22 с ws21.   

ip a:
![](images/qwe.png)
ping:
![](images/pingg.png)

Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true

ws11:     
![](images/yaml.png)
![](images/vm.png)

Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты

![](images/r1dhcp.png)
![](images/auth.png)
![](images/r1dns.png)
![](images/rest.png)
![](images/qwe.png)
![](images/ipaws1.png)
![](images/pingws1.png)

Запросить с ws21 обновление ip адреса

![](images/ipab4.png)
![](images/ipaafter.png)

**$ dhclient -r** чтобы освободить адрес  
**$ dhclient** чтобы получить новый

###Part 7. NAT

**$ sudo apt install apache2**     

ws22:    
![](images/ws22apache.png)
![](images/ws22start.png)
r1:    
![](images/r1apache.png)
![](images/r1start.png)
r2 iptables:    
![](images/firewall.png)
ping:    
![](images/ping1s.png)
r2 iptables:       
![](images/tables.png)
pings:      
![](images/2ping.png)
r2 iptables:      
![](images/asd.png)
telnet test:   
![](images/mnb.png)


